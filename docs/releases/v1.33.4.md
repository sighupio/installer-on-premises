# On Premises module release v1.33.4

Welcome to the latest release of `on-premises` module of [`SIGHUP Distribution`](https://github.com/sighupio/distribution) maintained by SIGHUP by ReeVo team.

This release adds support for Kubernetes v1.33.4, v1.32.8, v1.31.12

## Package Versions ðŸš¢

### v1.33.4

| Package                                        | Supported Version | Previous Version |
| ---------------------------------------------- | ----------------- | ---------------- |
| [etcd](roles/etcd)                             | `3.5.21`          | `3.5.16`         |
| [haproxy](roles/haproxy)                       | `3.0`             | `No update`      |
| [containerd](roles/containerd)                 | `1.7.28`          | `1.7.26`         |
| [kube-node-common](roles/kube-node-common)     | `-`               | `Updated`        |
| [kube-control-plane](roles/kube-control-plane) | `-`               | `Updated`        |
| [kube-worker](roles/kube-worker)               | `-`               | `No update`      |

### v1.32.8

| Package                                        | Supported Version | Previous Version |
| ---------------------------------------------- | ----------------- | ---------------- |
| [etcd](roles/etcd)                             | `3.5.21`          | `3.5.16`         |
| [haproxy](roles/haproxy)                       | `3.0`             | `No update`      |
| [containerd](roles/containerd)                 | `1.7.26`          | `No update`      |
| [kube-node-common](roles/kube-node-common)     | `-`               | `Updated`        |
| [kube-control-plane](roles/kube-control-plane) | `-`               | `Updated`        |
| [kube-worker](roles/kube-worker)               | `-`               | `No update`      |


### v1.31.12

| Package                                        | Supported Version | Previous Version |
| ---------------------------------------------- | ----------------- | ---------------- |
| [etcd](roles/etcd)                             | `3.5.21`          | `3.5.16`         |
| [haproxy](roles/haproxy)                       | `3.0`             | `No update`      |
| [containerd](roles/containerd)                 | `1.7.26`          | `No update`      |
| [kube-node-common](roles/kube-node-common)     | `-`               | `Updated`        |
| [kube-control-plane](roles/kube-control-plane) | `-`               | `Updated`        |
| [kube-worker](roles/kube-worker)               | `-`               | `No update`      |

## New features ðŸŒŸ

- [[#141](https://github.com/sighupio/installer-on-premises/pull/141)] **Add package repository lifecycle management**: Add package repository lifecycle management, 
now users can disable repository configuration when they manage repositories externally.

    New variables added:
    - containerd role: `containerd_manage_repositories: true` to control NVIDIA repository.
    - haproxy role: `haproxy_manage_repositories: true` to control HAProxy repository.
    - kube-node-common role: `kubernetes_manage_repositories: true` to control Kubernetes package repository.
    
- [[#142](https://github.com/sighupio/installer-on-premises/pull/142)] **Add compliance for the CIS Kubernetes Benchmark v1.10**: introducing several security improvements following the guidelines of the CIS Benchmark v1.10. The compliance is tested using the [kube-bench tool](https://github.com/aquasecurity/kube-bench).

- [[#144](https://github.com/sighupio/installer-on-premises/pull/144)] **Added compliance with CIS Kubernetes Benchmark v1.11**: Updates were made to audit log configurations to align with the CIS Kubernetes Benchmark v1.11. Compliance is verified using the [kube-bench tool](https://github.com/aquasecurity/kube-bench).

    The following variables are now set with default values:
    - `audit_policy_max_age: 30`.
    - `audit_policy_max_size: 100`.
    - `audit_policy_max_backup: 10`.

- [#145](https://github.com/sighupio/installer-on-premises/pull/145) **Allow setting containerd's `device_ownership_from_security_context` parameter**: the containerd role now allows to set the `device_ownership_from_security_context` parameter, needed for example when using KubeVirt.

## Breaking Changes ðŸ’”

### Kube-apiserver flags removed by upstream

The `--cloud-provider` and `--cloud-config` flags have been removed from kube-apiserver in Kubernetes v1.33.

No impact: clusters currently using empty values in roles (`kubernetes_cloud_provider: ""` and `kubernetes_cloud_config: ""`) will not be affected and require no changes.

Action required: clusters with active cloud provider configurations using these flags must follow the migration path below.

### New Kubelet ciphers variable

The Kubelet ciphers variable has changed from `tls_cipher_suites` to `kubelet_tls_cipher_suites`.

The old `tls_cipher_suites` is still used to configure etcd and API Server ciphers.

Action required: if you had configured the kubelet ciphers using the `tls_cipher_suites` variable, you need to copy the same ciphers in the new variable to leave them unchanged.

## Update Guide ðŸ¦®

###  Kube-apiserver flags migration path

1. Deploy an external Cloud Controller Manager (CCM)
2. Before upgrading to v1.33, ensure an external cloud controller manager appropriate for your cloud provider is deployed and verified as functional.
3. Set `kubernetes_cloud_provider` and `kubernetes_cloud_config` to empty values (`""`) and upgrade to this new version of the on-premises installer (which removes deprecated flags from kube-apiserver for v1.33+).
4. Configuration for the kube-controller-manager and kubelet remain unchanged.

### Automatic upgrade using furyctl

To update using furyctl, follow this [documentation](https://docs.sighup.io/docs/installation/upgrades).

### Manual update
  
> NOTE: Each on-premises environment can be different, always double-check before updating components.

1. Update SD if applicable (see the [SD release notes](https://github.com/sighupio/distribution/tree/master/docs/releases))
2. Update the cluster using playbooks, see the examples in this repository to know more.
